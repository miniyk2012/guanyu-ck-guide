<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§£è¯»"å…³äºCK"ï¼šåˆ©ç”¨ClickHouseå®ç°æ•°æ®å˜æ›´è¿½è¸ª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.8;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 15px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.95;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .content {
            padding: 50px 40px;
        }
        
        h2 {
            color: #667eea;
            font-size: 1.8em;
            margin-top: 40px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        h2:first-of-type {
            margin-top: 0;
        }
        
        h3 {
            color: #764ba2;
            font-size: 1.3em;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        
        p {
            margin-bottom: 15px;
            text-align: justify;
            font-size: 1.05em;
        }
        
        strong {
            color: #667eea;
            font-weight: 600;
        }
        
        em {
            color: #764ba2;
        }
        
        blockquote {
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
            font-style: italic;
            color: #555;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        
        table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            border: none;
        }
        
        table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        table tbody tr:hover {
            background: #f9f9f9;
        }
        
        table tbody tr:last-child td {
            border-bottom: none;
        }
        
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.95em;
            line-height: 1.8;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            white-space: pre;
            word-break: break-word;
            overflow-wrap: break-word;
        }
        
        .code-block .keyword {
            color: #f92672;
        }
        
        .code-block .function {
            color: #66d9ef;
        }
        
        .code-block .string {
            color: #e6db74;
        }
        
        .code-block .comment {
            color: #75715e;
        }
        
        .code-block .number {
            color: #ae81ff;
        }
        
        .highlight {
            background: #fff3cd;
            padding: 2px 6px;
            border-radius: 3px;
        }
        
        .feature-list {
            list-style: none;
            margin: 20px 0;
        }
        
        .feature-list li {
            padding: 12px 0;
            padding-left: 30px;
            position: relative;
            font-size: 1.05em;
        }
        
        .feature-list li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .scenario-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%);
            border-left: 4px solid #764ba2;
            padding: 20px;
            margin: 20px 0;
            border-radius: 6px;
        }
        
        .scenario-box h4 {
            color: #764ba2;
            margin-bottom: 10px;
        }
        
        .comparison-note {
            background: #e8f4f8;
            border-left: 4px solid #0288d1;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            color: #01579b;
        }
        
        .footer {
            background: #f5f7fa;
            padding: 30px 40px;
            text-align: center;
            color: #666;
            border-top: 1px solid #e0e0e0;
            font-size: 0.95em;
        }
        
        .toc {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 8px;
            margin: 30px 0;
            border: 1px solid #e0e0e0;
        }
        
        .toc h3 {
            margin-top: 0;
            color: #667eea;
        }
        
        .toc ul {
            list-style: none;
            padding-left: 0;
        }
        
        .toc li {
            padding: 8px 0;
            padding-left: 20px;
            position: relative;
        }
        
        .toc li:before {
            content: "â†’";
            position: absolute;
            left: 0;
            color: #667eea;
        }
        
        .toc a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .toc a:hover {
            color: #764ba2;
            text-decoration: underline;
        }
        
        .badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        
        .badge.success {
            background: #4caf50;
        }
        
        .badge.warning {
            background: #ff9800;
        }
        
        .badge.info {
            background: #2196f3;
        }
        

        .code-container {
            position: relative;
            margin: 20px 0;
        }
        
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            transition: background 0.3s;
            z-index: 10;
        }
        
        .copy-btn:hover {
            background: #764ba2;
        }
        
        .code-label {
            background: #f0f4ff;
            padding: 8px 15px;
            border-radius: 4px 4px 0 0;
            border-left: 3px solid #667eea;
            font-size: 0.9em;
            color: #667eea;
            font-weight: 600;
            margin-bottom: 0;
        }
        
        .sql-tip {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            color: #1565c0;
        }
        
        .sql-tip strong {
            color: #1565c0;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            color: #666;
            font-size: 1em;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .tab:hover {
            color: #667eea;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .step-counter {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .performance-chart {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #e0e0e0;
        }
        
        .bar {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }
        
        .bar-label {
            width: 120px;
            font-weight: 600;
            color: #333;
        }
        
        .bar-container {
            flex: 1;
            background: #e0e0e0;
            height: 30px;
            border-radius: 4px;
            overflow: hidden;
            margin: 0 15px;
        }
        
        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .bar-value {
            width: 80px;
            text-align: right;
            font-weight: 600;
            color: #333;
        }
        
        .note-box {
            background: #fff8e1;
            border-left: 4px solid #fbc02d;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            color: #f57f17;
        }
        
        .note-box strong {
            color: #f57f17;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .content {
                padding: 30px 20px;
            }
            
            h2 {
                font-size: 1.4em;
            }
            
            table {
                font-size: 0.9em;
            }
            
            table th, table td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š è§£è¯»"å…³äºCK"</h1>
            <p>åˆ©ç”¨ClickHouseå®ç°æ•°æ®å˜æ›´è¿½è¸ªçš„ä¼˜é›…æ–¹æ¡ˆ</p>
            <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px; display: inline-block;">
                <p style="margin: 0; font-size: 0.95em;">
                    ğŸ“– <strong>åŸå§‹æ–‡ç« ï¼š</strong> 
                    <a href="https://juejin.cn/post/7584358227611615274" 
                       target="_blank" 
                       style="color: white; text-decoration: underline; font-weight: 600;">
                        æ˜é‡‘ - å…³ç¾½CKï¼šåˆ©ç”¨ClickHouseå®ç°æ•°æ®å˜æ›´è¿½è¸ª
                    </a>
                </p>
            </div>
        </div>
        
        <div class="content">
            <p style="font-size: 1.1em; color: #666; margin-bottom: 30px;">
                æ‚¨å¥½ï¼æˆ‘å·²ç»è¯¦ç»†é˜…è¯»äº†æ‚¨æä¾›çš„æ˜é‡‘æ–‡ç« ï¼Œå¹¶ç»“åˆæ‚¨ç†Ÿæ‚‰çš„æŠ€æœ¯æ ˆï¼ˆJava/Python Webã€Spark/Flinkã€ClickHouseã€MySQLï¼‰ä»¥åŠç›¸å…³çš„äºšé©¬é€Šä¸šåŠ¡èƒŒæ™¯ï¼Œä¸ºæ‚¨æ•´ç†äº†è¿™ä»½å…¨é¢çš„è§£è¯»æ–‡æ¡£ã€‚å¸Œæœ›èƒ½å¸®åŠ©æ‚¨æ·±å…¥ç†è§£"å…³äºCK"è¿™ä¸€å·§å¦™çš„æ•°æ®å¤„ç†ç­–ç•¥ã€‚
            </p>
            
            <div style="background: #e8f5e9; border-left: 4px solid #4caf50; padding: 20px; margin: 20px 0; border-radius: 6px;">
                <p style="margin: 0; color: #2e7d32;">
                    <strong>ğŸ“š åŸå§‹æ–‡ç« æ¥æºï¼š</strong><br>
                    æœ¬æ–‡æ¡£åŸºäºæ˜é‡‘æ–‡ç«  
                    <a href="https://juejin.cn/post/7584358227611615274" target="_blank" style="color: #1b5e20; font-weight: 600; text-decoration: underline;">
                        ã€Šå…³ç¾½CKï¼šåˆ©ç”¨ClickHouseå®ç°æ•°æ®å˜æ›´è¿½è¸ªã€‹
                    </a> 
                    è¿›è¡Œæ·±åº¦è§£è¯»å’Œæ‰©å±•åˆ†æã€‚
                </p>
            </div>
            
            <div class="toc">
                <h3>ğŸ“‘ æ–‡æ¡£ç›®å½•</h3>
                <ul>
                    <li><a href="#section1">1. "å…³äºCK"åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</a></li>
                    <li><a href="#section2">2. æ ¸å¿ƒæŠ€æœ¯ï¼šReplacingMergeTreeå¼•æ“</a></li>
                    <li><a href="#section3">3. äºšé©¬é€Šä¸šåŠ¡ä¸æ•°æ®æµè§£é‡Š</a></li>
                    <li><a href="#section4">4. å®é™…åœºæ™¯æ¼”ç»ƒï¼šè¿½è¸ªé»‘äº”é”€é‡å˜åŒ–</a></li>
                    <li><a href="#section5">5. æŠ€æœ¯æ ˆå¯¹æ¯”ï¼šä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆæ›´ä¼˜ï¼Ÿ</a></li>
                    <li><a href="#section6">6. ä¸"æ‹‰é“¾è¡¨"çš„å¼‚åŒ</a></li>
                    <li><a href="#section7">7. æ€»ç»“</a></li>
                    <li><a href="#section8">8. å¸¸è§é—®é¢˜è§£ç­” (FAQ)</a></li>
                    <li><a href="#section9">9. å…³é”®æ¦‚å¿µé€ŸæŸ¥è¡¨</a></li>
                    <li><a href="#section10">10. æœ€ä½³å®è·µä¸å®ç°æŒ‡å—</a></li>
                </ul>
            </div>
            
            <h2 id="section1">1. "å…³äºCK"åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
            
            <p>
                æ–‡ç« æ ‡é¢˜ä¸­çš„"å…³äºCK"ï¼ˆè°éŸ³"å…³ç¾½CK"ï¼‰æŒ‡çš„æ˜¯"å…³äºClickHouse"ã€‚è¿™ç¯‡æ–‡ç« çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>åˆ©ç”¨ClickHouseçš„<code>ReplacingMergeTree</code>è¡¨å¼•æ“ï¼Œé€šè¿‡åªè¿½åŠ ï¼ˆINSERT-onlyï¼‰çš„æ–¹å¼ï¼Œå·§å¦™åœ°å®ç°å¯¹æ•°æ®å˜æ›´å†å²çš„è¿½è¸ªå’Œå‡†å®æ—¶å¿«ç…§æŸ¥è¯¢</strong>ã€‚è¿™ç±»ä¼¼äºæ‚¨æåˆ°çš„"æ‹‰é“¾è¡¨"ï¼ˆSlowly Changing Dimension Type 2ï¼‰ï¼Œä½†å®ç°æ–¹å¼æ›´ç®€å•ã€æŸ¥è¯¢æ•ˆç‡æ›´é«˜ï¼Œå°¤å…¶é€‚ç”¨äºæµ·é‡æ•°æ®çš„å®æ—¶åˆ†æåœºæ™¯ã€‚
            </p>
            
            <p>
                ç®€å•æ¥è¯´ï¼Œè¯¥æ–¹æ¡ˆè§£å†³äº†è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼š<strong>å¦‚ä½•åœ¨ä¸ä½¿ç”¨ä¼ ç»Ÿ<code>UPDATE</code>æ“ä½œçš„å‰æä¸‹ï¼Œé«˜æ•ˆåœ°æ¯”è¾ƒä¸€æ¡è®°å½•åœ¨"å½“å‰"å’Œ"è¿‡å»æŸä¸ªæ—¶é—´ç‚¹"ï¼ˆä¾‹å¦‚6å°æ—¶å‰ï¼‰çš„çŠ¶æ€å·®å¼‚</strong>ã€‚
            </p>
            
            <h2 id="section2">2. æ ¸å¿ƒæŠ€æœ¯ï¼š<code>ReplacingMergeTree</code>å¼•æ“</h2>
            
            <p>
                è¦ç†è§£è¿™ä¸ªæ–¹æ¡ˆï¼Œé¦–å…ˆè¦æ˜ç™½<code>ReplacingMergeTree</code>å¼•æ“çš„å·¥ä½œæœºåˆ¶ã€‚å®ƒç»§æ‰¿è‡ªClickHouseæœ€åŸºç¡€çš„<code>MergeTree</code>å¼•æ“ï¼Œä½†å¢åŠ äº†ä¸€ä¸ªå…³é”®ç‰¹æ€§ï¼š<strong>æ•°æ®å»é‡</strong>ã€‚
            </p>
            
            <blockquote>
                <strong>ReplacingMergeTreeçš„è¯­ä¹‰</strong>ï¼š<br>
                1. å®ƒå…è®¸è¡¨ä¸­å­˜åœ¨å¤šæ¡å…·æœ‰ç›¸åŒ<strong>æ’åºé”®</strong>ï¼ˆ<code>ORDER BY</code>æŒ‡å®šçš„é”®ï¼‰çš„è®°å½•ã€‚<br>
                2. åœ¨åå°è¿›è¡Œæ•°æ®åˆ†åŒºåˆå¹¶ï¼ˆMergeï¼‰æ—¶ï¼Œå®ƒä¼šæ ¹æ®ä¸€ä¸ªå¯é€‰çš„<code>version</code>å­—æ®µï¼Œåœ¨æ‰€æœ‰æ’åºé”®ç›¸åŒçš„è®°å½•ä¸­ï¼Œ<strong>åªä¿ç•™<code>version</code>å€¼æœ€å¤§çš„é‚£ä¸€æ¡</strong>ã€‚å¦‚æœæœªæŒ‡å®š<code>version</code>ï¼Œåˆ™ä¿ç•™æœ€åæ’å…¥çš„é‚£æ¡ã€‚<br>
                3. <strong>å»é‡åªåœ¨åˆå¹¶æ—¶å‘ç”Ÿ</strong>ï¼Œè¿™æ˜¯ä¸€ä¸ªåå°å¼‚æ­¥ã€ä¸ç¡®å®šçš„è¿‡ç¨‹ã€‚è¿™æ„å‘³ç€åœ¨åˆå¹¶ä¹‹å‰ï¼Œæ‰€æœ‰ç‰ˆæœ¬çš„æ•°æ®éƒ½æš‚æ—¶å…±å­˜äºè¡¨ä¸­ã€‚
            </blockquote>
            
            <p>
                æ­£æ˜¯è¿™ä¸ª"å»¶è¿Ÿå»é‡"å’Œ"ä¿ç•™æœ€æ–°ç‰ˆæœ¬"çš„ç‰¹æ€§ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªçŸ­æš‚çš„"æ—¶é—´çª—å£"ï¼Œåœ¨è¿™ä¸ªçª—å£å†…ï¼Œæˆ‘ä»¬å¯ä»¥"å›çœ‹"åˆ°æ—§ç‰ˆæœ¬çš„æ•°æ®ã€‚
            </p>
            
            <h2 id="section3">3. äºšé©¬é€Šä¸šåŠ¡ä¸æ•°æ®æµè§£é‡Š</h2>
            
            <p>
                æ–‡ç« ä»¥äºšé©¬é€Šç”µå•†çš„è®¢å•æ•°æ®ä¸ºä¾‹ï¼Œè¿™éå¸¸å…¸å‹ã€‚æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ç›¸å…³çš„ä¸šåŠ¡æ¦‚å¿µã€‚
            </p>
            
            <h3>å…³é”®ä¸šåŠ¡æœ¯è¯­</h3>
            
            <table>
                <thead>
                    <tr>
                        <th>æœ¯è¯­</th>
                        <th>è§£é‡Š</th>
                        <th>ç¤ºä¾‹</th>
                        <th>ä½œç”¨</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>ASIN</strong></td>
                        <td>äºšé©¬é€Šæ ‡å‡†è¯†åˆ«ç  (Amazon Standard Identification Number)</td>
                        <td><code>B08J65V45G</code></td>
                        <td>å¹³å°çº§çš„<strong>å•†å“èº«ä»½è¯</strong>ï¼Œå…¨å±€å”¯ä¸€ã€‚</td>
                    </tr>
                    <tr>
                        <td><strong>SKU</strong></td>
                        <td>åº“å­˜å•ä½ (Stock Keeping Unit)</td>
                        <td><code>MY-PRODUCT-RED-L</code></td>
                        <td>å–å®¶çº§çš„<strong>åº“å­˜ç¼–ç </strong>ï¼Œç”¨äºç®¡ç†è‡ªå·±çš„å•†å“ã€‚</td>
                    </tr>
                    <tr>
                        <td><strong>Order Status</strong></td>
                        <td>è®¢å•çŠ¶æ€</td>
                        <td><code>Pending, Shipped</code></td>
                        <td>è¿½è¸ªè®¢å•ä»åˆ›å»ºåˆ°å®Œæˆçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚</td>
                    </tr>
                    <tr>
                        <td><strong>SP-API</strong></td>
                        <td>é”€å”®ä¼™ä¼´API (Selling Partner API)</td>
                        <td><code>getOrders, getOrderItems</code></td>
                        <td>äºšé©¬é€Šæä¾›çš„RESTful APIï¼Œä¾›å–å®¶ä»¥ç¼–ç¨‹æ–¹å¼è®¿é—®è®¢å•ã€åº“å­˜ç­‰æ•°æ®ã€‚</td>
                    </tr>
                </tbody>
            </table>
            
            <h3>æ•°æ®å¦‚ä½•äº§ç”Ÿï¼Ÿï¼ˆç»“åˆJava/Python Webï¼‰</h3>
            
            <p>
                æ‚¨å¯ä»¥æƒ³è±¡ä¸€ä¸ªç”¨Javaæˆ–Pythonç¼–å†™çš„åç«¯æœåŠ¡ï¼Œå®ƒä¼šå®šæœŸæ‰§è¡Œä»¥ä¸‹ä»»åŠ¡ï¼š
            </p>
            
            <ol style="margin-left: 20px; margin-bottom: 15px;">
                <li><strong>è°ƒç”¨SP-API</strong>ï¼šé€šè¿‡<code>lastUpdatedAfter</code>å‚æ•°ï¼Œæ¯éš”å‡ åˆ†é’Ÿè°ƒç”¨äºšé©¬é€Šçš„<code>getOrders</code>å’Œ<code>getOrderItems</code>æ¥å£ï¼Œæ‹‰å–æœ€è¿‘æœ‰çŠ¶æ€æ›´æ–°çš„è®¢å•æ•°æ®ã€‚</li>
                <li><strong>å¤„ç†æ•°æ®</strong>ï¼šå°†æ‹‰å–åˆ°çš„JSONæ•°æ®è§£ææˆè®¢å•å¯¹è±¡æˆ–è®¢å•é¡¹å¯¹è±¡ã€‚</li>
                <li><strong>ç”Ÿæˆæ–°ç‰ˆæœ¬</strong>ï¼šå¯¹äºæ¯ä¸€æ¡æœ‰å˜æ›´çš„æ•°æ®ï¼ˆæ— è®ºæ˜¯çŠ¶æ€ä»<code>Pending</code>å˜ä¸º<code>Shipped</code>ï¼Œè¿˜æ˜¯ä¹°å®¶ä¿®æ”¹äº†è´­ä¹°æ•°é‡ï¼‰ï¼Œç¨‹åºéƒ½<strong>ä¸ä¼šå»æ›´æ–°æ•°æ®åº“</strong>ã€‚ç›¸åï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ª<strong>æ–°çš„æ•°æ®ç‰ˆæœ¬</strong>ï¼ŒåŒ…å«ä¸€ä¸ª<strong>é€’å¢çš„<code>version</code>å·</strong>ï¼ˆé€šå¸¸æ˜¯æ—¶é—´æˆ³ï¼‰å’Œ<strong>å½“å‰çš„<code>update_time</code></strong>ã€‚</li>
                <li><strong>å†™å…¥ClickHouse</strong>ï¼šå°†è¿™ä¸ªæ–°ç‰ˆæœ¬çš„æ•°æ®ä½œä¸ºä¸€ä¸ªæ–°çš„è®°å½•<code>INSERT</code>åˆ°ClickHouseçš„<code>ReplacingMergeTree</code>è¡¨ä¸­ã€‚</li>
            </ol>
            
            <p>
                è¿™ä¸ªè¿‡ç¨‹å®Œå…¨ç¬¦åˆæ–‡ç« ä¸­æåˆ°çš„<strong>"åªINSERTï¼Œä¸UPDATEã€ä¸DELETE"</strong>çš„æ ¸å¿ƒåŸåˆ™ã€‚
            </p>
            
            <h2 id="section4">4. å®é™…åœºæ™¯æ¼”ç»ƒï¼šè¿½è¸ªé»‘äº”é”€é‡å˜åŒ–</h2>
            
            <p>
                è®©æˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸ª"é»‘è‰²æ˜ŸæœŸäº”"çš„çœŸå®åœºæ™¯ï¼Œçœ‹çœ‹è¿™ä¸ªæ–¹æ¡ˆå¦‚ä½•è¿ä½œã€‚
            </p>
            
            <div class="scenario-box">
                <h4>ğŸ“‹ æ•°æ®è¡¨ç»“æ„ (ç®€åŒ–ç‰ˆ)</h4>
                <div class="code-block"><span class="keyword">CREATE TABLE</span> amzn_order_item (
    id <span class="keyword">String</span>,                      <span class="comment">-- è®¢å•é¡¹å”¯ä¸€ID</span>
    seller_sku <span class="keyword">String</span>,              <span class="comment">-- å–å®¶SKU</span>
    quantity_ordered <span class="keyword">Int32</span>,         <span class="comment">-- è®¢è´­æ•°é‡</span>
    is_delete <span class="keyword">UInt8</span>,                <span class="comment">-- è½¯åˆ é™¤æ ‡è®°</span>
    version <span class="keyword">Int64</span>,                  <span class="comment">-- ç‰ˆæœ¬å· (æ—¶é—´æˆ³)</span>
    update_time <span class="keyword">DateTime64</span>(<span class="number">3</span>)       <span class="comment">-- è®°å½•æ›´æ–°æ—¶é—´</span>
)
<span class="keyword">ENGINE</span> = <span class="function">ReplacingMergeTree</span>(version)
<span class="keyword">ORDER BY</span> id;                        <span class="comment">-- æŒ‰idå»é‡</span></div>
            </div>
            
            <h3>äº‹ä»¶æµ</h3>
            
            <ol style="margin-left: 20px; margin-bottom: 20px;">
                <li>
                    <strong>10:00</strong> - é¡¾å®¢Aä¸‹å•è´­ä¹°äº†2ä»¶<code>SKU-001</code>ã€‚
                    <div class="code-block"><span class="keyword">INSERT INTO</span> amzn_order_item <span class="keyword">VALUES</span>
    (<span class="string">'item-xyz'</span>, <span class="string">'SKU-001'</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1732701600000</span>, <span class="string">'2025-12-17 10:00:00'</span>)</div>
                </li>
                <li>
                    <strong>12:00</strong> - é¡¾å®¢Aåœ¨å‘è´§å‰ä¿®æ”¹è®¢å•ï¼Œå°†æ•°é‡å¢åŠ åˆ°3ä»¶ã€‚
                    <div class="code-block"><span class="keyword">INSERT INTO</span> amzn_order_item <span class="keyword">VALUES</span>
    (<span class="string">'item-xyz'</span>, <span class="string">'SKU-001'</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">1732708800000</span>, <span class="string">'2025-12-17 12:00:00'</span>)</div>
                </li>
                <li>
                    <strong>14:00</strong> - é¡¾å®¢Bä¸‹å•è´­ä¹°äº†5ä»¶<code>SKU-001</code>ã€‚
                    <div class="code-block"><span class="keyword">INSERT INTO</span> amzn_order_item <span class="keyword">VALUES</span>
    (<span class="string">'item-abc'</span>, <span class="string">'SKU-001'</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">1732716000000</span>, <span class="string">'2025-12-17 14:00:00'</span>)</div>
                </li>
                <li>
                    <strong>15:00</strong> - é¡¾å®¢Aå–æ¶ˆäº†è®¢å•ï¼ˆä¸šåŠ¡é€»è¾‘ä¸Šé€šè¿‡æ’å…¥ä¸€æ¡<code>is_delete=1</code>çš„æ–°ç‰ˆæœ¬æ¥å®ç°è½¯åˆ é™¤ï¼‰ã€‚
                    <div class="code-block"><span class="keyword">INSERT INTO</span> amzn_order_item <span class="keyword">VALUES</span>
    (<span class="string">'item-xyz'</span>, <span class="string">'SKU-001'</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1732719600000</span>, <span class="string">'2025-12-17 15:00:00'</span>)</div>
                </li>
            </ol>
            
            <h3>æŸ¥è¯¢åˆ†æ (ä¸‹åˆ16:00)</h3>
            
            <p>
                ç°åœ¨æ˜¯ä¸‹åˆ16:00ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“<code>SKU-001</code>åœ¨è¿‡å»6å°æ—¶ï¼ˆå³10:00ä¹‹åï¼‰çš„å‡€é”€é‡å˜åŒ–ã€‚
            </p>
            
            <div class="code-block"><span class="comment">-- å®šä¹‰å½“å‰æ—¶é—´å’Œ6å°æ—¶å‰çš„æ—¶é—´ç‚¹</span>
<span class="keyword">WITH</span>
    <span class="function">now</span>() <span class="keyword">AS</span> now_ts,
    now_ts - <span class="keyword">INTERVAL</span> <span class="number">6</span> <span class="keyword">HOUR</span> <span class="keyword">AS</span> t0_ts

<span class="keyword">SELECT</span>
    seller_sku,
    <span class="comment">-- è®¡ç®—å½“å‰æœ‰æ•ˆé”€é‡</span>
    <span class="function">sumIf</span>(qty_now, is_delete_now = <span class="number">0</span>) <span class="keyword">AS</span> current_sales,
    <span class="comment">-- è®¡ç®—6å°æ—¶å‰æœ‰æ•ˆé”€é‡</span>
    <span class="function">sumIf</span>(qty_t0, is_delete_t0 = <span class="number">0</span>) <span class="keyword">AS</span> sales_6h_ago,
    <span class="comment">-- è®¡ç®—é”€é‡å·®å€¼</span>
    current_sales - sales_6h_ago <span class="keyword">AS</span> delta_sales
<span class="keyword">FROM</span>
(
    <span class="keyword">SELECT</span>
        id,
        seller_sku,
        <span class="comment">-- è·å–å½“å‰æœ€æ–°çŠ¶æ€</span>
        <span class="function">argMax</span>(quantity_ordered, version) <span class="keyword">AS</span> qty_now,
        <span class="function">argMax</span>(is_delete, version) <span class="keyword">AS</span> is_delete_now,
        <span class="comment">-- è·å–6å°æ—¶å‰çš„æœ€æ–°çŠ¶æ€ (as-of query)</span>
        <span class="function">argMaxIf</span>(quantity_ordered, version, update_time <= t0_ts) <span class="keyword">AS</span> qty_t0,
        <span class="function">argMaxIf</span>(is_delete, version, update_time <= t0_ts) <span class="keyword">AS</span> is_delete_t0
    <span class="keyword">FROM</span> amzn_order_item
    <span class="comment">-- ä¼˜åŒ–ï¼šåªæ‰«ææœ€è¿‘ä¸€æ®µæ—¶é—´çš„æ•°æ®</span>
    <span class="keyword">WHERE</span> update_time >= t0_ts - <span class="keyword">INTERVAL</span> <span class="number">2</span> <span class="keyword">DAY</span>
    <span class="keyword">GROUP BY</span> id, seller_sku
)
<span class="keyword">GROUP BY</span> seller_sku;</div>
            
            <h3>æŸ¥è¯¢ç»“æœåˆ†æ</h3>
            
            <ul class="feature-list">
                <li><strong>current_sales</strong>: 5ã€‚å› ä¸º<code>item-xyz</code>çš„æœ€æ–°ç‰ˆæœ¬æ˜¯åˆ é™¤çŠ¶æ€ï¼Œä¸è®¡å…¥é”€é‡ï¼›<code>item-abc</code>çš„é”€é‡æ˜¯5ã€‚</li>
                <li><strong>sales_6h_ago</strong>: 2ã€‚åœ¨10:00é‚£ä¸ªæ—¶é—´ç‚¹ï¼Œåªæœ‰<code>item-xyz</code>å­˜åœ¨ï¼Œä¸”é”€é‡ä¸º2ã€‚</li>
                <li><strong>delta_sales</strong>: 3ã€‚è®¡ç®—ç»“æœä¸º <code>5 - 2 = 3</code>ã€‚</li>
            </ul>
            
            <p>
                è¿™ä¸ªæŸ¥è¯¢å®Œç¾åœ°è¿˜åŸäº†ä¸¤ä¸ªæ—¶é—´ç‚¹çš„çŠ¶æ€ï¼Œå¹¶ç»™å‡ºäº†ç²¾ç¡®çš„å¢é‡ï¼Œè€Œè¿™ä¸€åˆ‡ä»…é€šè¿‡ä¸€æ¡SQLå°±å®Œæˆäº†ï¼Œæ— éœ€å¤æ‚çš„ETLæˆ–åº”ç”¨å±‚é€»è¾‘ã€‚
            </p>
            
            <h2 id="section5">5. æŠ€æœ¯æ ˆå¯¹æ¯”ï¼šä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆæ›´ä¼˜ï¼Ÿ</h2>
            
            <p>
                å°†è¿™ä¸ªæ–¹æ¡ˆä¸æ‚¨ç†Ÿæ‚‰çš„å…¶ä»–æŠ€æœ¯è¿›è¡Œå¯¹æ¯”ï¼Œèƒ½æ›´å¥½åœ°çªæ˜¾å…¶ä¼˜åŠ¿ã€‚
            </p>
            
            <h3>å¯¹æ¯” Spark / Flink</h3>
            
            <table>
                <thead>
                    <tr>
                        <th>æ–¹æ¡ˆ</th>
                        <th>ClickHouse (æœ¬æ–‡æ–¹æ¡ˆ)</th>
                        <th>Flink</th>
                        <th>Spark</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>å®ç°æ–¹å¼</strong></td>
                        <td>å•æ¡SQLï¼Œåˆ©ç”¨<code>argMaxIf</code>è¿›è¡Œas-ofæŸ¥è¯¢</td>
                        <td>ç»´æŠ¤ä¸€ä¸ªæœ‰çŠ¶æ€çš„<code>KeyedProcessFunction</code></td>
                        <td>å®šæœŸè¿è¡Œæ‰¹å¤„ç†ä½œä¸šï¼ŒJoinä¸¤ä¸ªæ—¶é—´ç‚¹çš„å¿«ç…§</td>
                    </tr>
                    <tr>
                        <td><strong>å¤æ‚åº¦</strong></td>
                        <td><span class="badge success">ä½</span>ã€‚æ— éœ€ç¼–å†™å¤æ‚çš„åº”ç”¨ä»£ç ã€‚</td>
                        <td><span class="badge warning">é«˜</span>ã€‚éœ€è¦ç®¡ç†çŠ¶æ€ã€å®šæ—¶å™¨ã€å®¹é”™ã€‚</td>
                        <td><span class="badge">ä¸­</span>ã€‚éœ€è¦è°ƒåº¦ETLä»»åŠ¡ï¼Œç®¡ç†ä¸­é—´æ•°æ®ã€‚</td>
                    </tr>
                    <tr>
                        <td><strong>å®æ—¶æ€§</strong></td>
                        <td><span class="badge info">å‡†å®æ—¶</span>ï¼ˆç§’çº§å»¶è¿Ÿï¼‰ã€‚</td>
                        <td><span class="badge info">å®æ—¶</span>ï¼ˆæ¯«ç§’çº§å»¶è¿Ÿï¼‰ã€‚</td>
                        <td><span class="badge">è¿‘å®æ—¶</span>ï¼ˆåˆ†é’Ÿåˆ°å°æ—¶çº§å»¶è¿Ÿï¼‰ã€‚</td>
                    </tr>
                    <tr>
                        <td><strong>é€‚ç”¨åœºæ™¯</strong></td>
                        <td>çµæ´»çš„ã€å³å¸­çš„OLAPåˆ†æã€‚</td>
                        <td>ä¸¥æ ¼çš„ã€ä½å»¶è¿Ÿçš„æµå¼è®¡ç®—ã€‚</td>
                        <td>ç¦»çº¿çš„ã€å¤§è§„æ¨¡çš„æ•°æ®å¤„ç†ã€‚</td>
                    </tr>
                </tbody>
            </table>
            
            <p>
                å¯¹äº"è¿½è¸ªé”€é‡å˜åŒ–"è¿™ç±»åˆ†æå‹éœ€æ±‚ï¼ŒClickHouseæ–¹æ¡ˆåœ¨å®ç°ç®€å•æ€§å’ŒæŸ¥è¯¢çµæ´»æ€§ä¸Šè¿œèƒœäºFlinkå’ŒSparkã€‚
            </p>
            <h3>æ€§èƒ½å¯¹æ¯”å¯è§†åŒ–</h3>
            
            <div class="performance-chart">
                <div class="bar">
                    <div class="bar-label">ClickHouse</div>
                    <div class="bar-container">
                        <div class="bar-fill" style="width: 95%;">æå¿«</div>
                    </div>
                    <div class="bar-value">100ms</div>
                </div>
                <div class="bar">
                    <div class="bar-label">Spark</div>
                    <div class="bar-container">
                        <div class="bar-fill" style="width: 40%;">è¾ƒæ…¢</div>
                    </div>
                    <div class="bar-value">5-30s</div>
                </div>
                <div class="bar">
                    <div class="bar-label">Flink</div>
                    <div class="bar-container">
                        <div class="bar-fill" style="width: 50%;">ä¸­ç­‰</div>
                    </div>
                    <div class="bar-value">1-5s</div>
                </div>
                <div class="bar">
                    <div class="bar-label">MySQL</div>
                    <div class="bar-container">
                        <div class="bar-fill" style="width: 20%;">å¾ˆæ…¢</div>
                    </div>
                    <div class="bar-value">30s+</div>
                </div>
            </div>
            
            <div class="note-box">
                <strong>ğŸ’¡ æ³¨æ„ï¼š</strong> ä¸Šè¿°æ•°æ®åŸºäºæŸ¥è¯¢10äº¿è¡Œè®¢å•æ•°æ®ã€æŒ‰SKUèšåˆçš„åœºæ™¯ã€‚ClickHouseçš„åˆ—å¼å­˜å‚¨å’Œèšåˆä¼˜åŒ–ä½¿å…¶åœ¨OLAPåœºæ™¯ä¸‹æ€§èƒ½é¥é¥é¢†å…ˆã€‚
            </div>
            
            
            <h3>å¯¹æ¯” MySQL</h3>
            
            <table>
                <thead>
                    <tr>
                        <th>æ–¹æ¡ˆ</th>
                        <th>ClickHouse</th>
                        <th>MySQL</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>å­˜å‚¨æ¨¡å‹</strong></td>
                        <td><strong>åˆ—å¼å­˜å‚¨</strong>ã€‚èšåˆæŸ¥è¯¢åªè¯»å–éœ€è¦çš„åˆ—ï¼Œé€Ÿåº¦æå¿«ã€‚</td>
                        <td><strong>è¡Œå¼å­˜å‚¨</strong>ã€‚èšåˆæŸ¥è¯¢éœ€è¦è¯»å–æ•´è¡Œï¼ŒI/Oå¼€é”€å¤§ã€‚</td>
                    </tr>
                    <tr>
                        <td><strong>æŸ¥è¯¢æ€§èƒ½</strong></td>
                        <td><strong>æé«˜</strong>ã€‚ä¸ºOLAPè®¾è®¡ï¼Œè½»æ¾å¤„ç†æ•°åäº¿è¡Œæ•°æ®ã€‚</td>
                        <td><strong>è¾ƒä½</strong>ã€‚åœ¨æµ·é‡æ•°æ®ä¸‹ï¼Œ<code>GROUP BY</code>èšåˆä¼šéå¸¸æ…¢ã€‚</td>
                    </tr>
                    <tr>
                        <td><strong>æ•°æ®å‹ç¼©</strong></td>
                        <td><strong>é«˜</strong>ã€‚åˆ—å¼å­˜å‚¨åŒç±»å‹æ•°æ®è¿ç»­å­˜æ”¾ï¼Œå‹ç¼©ç‡é«˜ã€‚</td>
                        <td><strong>ä½</strong>ã€‚</td>
                    </tr>
                </tbody>
            </table>
            
            <div class="comparison-note">
                å¦‚æœå°†ä¸Šäº¿æ¡è®¢å•å˜æ›´è®°å½•å­˜å…¥MySQLï¼Œæ‰§è¡Œä¸Šè¿°çš„èšåˆæŸ¥è¯¢å°†æ˜¯ä¸€åœºç¾éš¾ã€‚è€ŒClickHouseçš„åˆ—å¼å­˜å‚¨å¤©ç”Ÿå°±æ˜¯ä¸ºè¿™ç±»åˆ†æåœºæ™¯è€Œç”Ÿã€‚
            </div>
            
            <h2 id="section6">6. ä¸"æ‹‰é“¾è¡¨"çš„å¼‚åŒ</h2>
            
            <p>
                æ‚¨è§‰å¾—å®ƒåƒ"æ‹‰é“¾è¡¨"ï¼Œè¿™ä¸ªè§‚å¯Ÿéå¸¸å‡†ç¡®ã€‚å®ƒä»¬éƒ½æ—¨åœ¨ä¿å­˜æ•°æ®çš„å†å²çŠ¶æ€ï¼Œä½†å®ç°å“²å­¦ä¸åŒã€‚
            </p>
            
            <table>
                <thead>
                    <tr>
                        <th>ç‰¹æ€§</th>
                        <th>æ‹‰é“¾è¡¨ (SCD2)</th>
                        <th>"å…³äºCK"æ–¹æ¡ˆ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>æ ¸å¿ƒæ€æƒ³</strong></td>
                        <td>ç”¨<code>start_date</code>å’Œ<code>end_date</code>æ ‡è®°æ¯æ¡è®°å½•çš„<strong>æœ‰æ•ˆæ—¶é—´èŒƒå›´</strong>ã€‚</td>
                        <td>ç”¨<code>version</code>å’Œ<code>update_time</code>æ ‡è®°æ¯ä¸ª<strong>æ•°æ®ç‰ˆæœ¬</strong>ã€‚</td>
                    </tr>
                    <tr>
                        <td><strong>æ•°æ®ç»´æŠ¤</strong></td>
                        <td><strong>å¤æ‚</strong>ã€‚æ›´æ–°æ—¶éœ€è¦"å°å­˜"æ—§è®°å½•ï¼ˆæ›´æ–°<code>end_date</code>ï¼‰ï¼Œå¹¶æ’å…¥æ–°è®°å½•ã€‚</td>
                        <td><strong>ç®€å•</strong>ã€‚åªéœ€<code>INSERT</code>æ–°ç‰ˆæœ¬è®°å½•ã€‚</td>
                    </tr>
                    <tr>
                        <td><strong>æ—¶é—´ç²’åº¦</strong></td>
                        <td>é€šå¸¸æ˜¯å¤©çº§ã€‚</td>
                        <td>å¯ä»¥æ˜¯<strong>æ¯«ç§’çº§</strong>ï¼Œç²¾åº¦æ›´é«˜ã€‚</td>
                    </tr>
                    <tr>
                        <td><strong>æŸ¥è¯¢æ–¹å¼</strong></td>
                        <td><code>WHERE query_time BETWEEN start_date AND end_date</code></td>
                        <td><code>argMaxIf(..., update_time <= query_time)</code></td>
                    </tr>
                    <tr>
                        <td><strong>é€‚ç”¨åœºæ™¯</strong></td>
                        <td>æ•°æ®ä»“åº“ä¸­çš„ä½é¢‘æ›´æ–°ç»´åº¦è¡¨ã€‚</td>
                        <td>OLAPåœºæ™¯ä¸­é«˜é¢‘å˜æ›´çš„äº‹å®è¡¨æˆ–çŠ¶æ€è¡¨ã€‚</td>
                    </tr>
                </tbody>
            </table>
            
            <p>
                æ€»çš„æ¥è¯´ï¼Œ"å…³äºCK"æ–¹æ¡ˆå¯ä»¥çœ‹ä½œæ˜¯<strong>ä¸€ç§åœ¨OLAPé¢†åŸŸå®ç°çš„ã€æ›´è½»é‡ã€æ›´å®æ—¶çš„"æ‹‰é“¾è¡¨"</strong>ã€‚
            </p>
            
            <h2 id="section8">8. å¸¸è§é—®é¢˜è§£ç­” (FAQ)</h2>
            
            <h3>Q1: ä¸ºä»€ä¹ˆå¿…é¡»ç”¨versionå­—æ®µï¼Ÿä¸èƒ½ç”¨update_timeå—ï¼Ÿ</h3>
            <p>
                <strong>A:</strong> versionå­—æ®µæ˜¯<strong>å¿…éœ€çš„</strong>ï¼Œå› ä¸ºå®ƒç”¨äº<code>ReplacingMergeTree</code>çš„å»é‡åˆ¤æ–­ã€‚è™½ç„¶update_timeä¹Ÿæ˜¯é€’å¢çš„ï¼Œä½†versionæ˜¯ä¸“é—¨ä¸ºå»é‡è®¾è®¡çš„ã€‚update_timeçš„ä½œç”¨æ˜¯æ ‡è®°"å¿«ç…§æ—¶é—´"ï¼Œç”¨äºas-ofæŸ¥è¯¢ã€‚ä¸¤è€…ç¼ºä¸€ä¸å¯ã€‚
            </p>
            
            <h3>Q2: å¦‚æœmergeæ²¡æœ‰å‘ç”Ÿï¼Œä¼šä¸ä¼šæŸ¥è¯¢ç»“æœä¸å‡†ç¡®ï¼Ÿ</h3>
            <p>
                <strong>A:</strong> ä¸ä¼šã€‚å³ä½¿mergeè¿˜æ²¡å‘ç”Ÿï¼Œå¤šä¸ªç‰ˆæœ¬çš„æ•°æ®éƒ½å­˜åœ¨è¡¨ä¸­ï¼Œ<code>argMaxIf</code>å‡½æ•°ä»ç„¶èƒ½æ­£ç¡®åœ°é€‰å‡ºversionæœ€å¤§çš„é‚£ä¸€è¡Œã€‚mergeåªæ˜¯ä¸ºäº†èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œä¸å½±å“æŸ¥è¯¢é€»è¾‘ã€‚
            </p>
            
            <h3>Q3: 2å¤©çš„ä¿ç•™çª—å£æ˜¯ç¡¬æ€§è¦æ±‚å—ï¼Ÿ</h3>
            <p>
                <strong>A:</strong> ä¸æ˜¯ã€‚æ‚¨å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´ã€‚å¦‚æœéœ€è¦è¿½è¸ª1å°æ—¶å†…çš„å˜åŒ–ï¼Œå¯ä»¥è®¾ç½®ä¿ç•™çª—å£ä¸º1å¤©ï¼›å¦‚æœéœ€è¦è¿½è¸ª7å¤©ï¼Œå¯ä»¥è®¾ç½®ä¸º8å¤©ã€‚åªè¦ä¿ç•™çª—å£ > æŸ¥è¯¢çª—å£ï¼Œå°±èƒ½ä¿è¯æ•°æ®å¯è¿˜åŸã€‚
            </p>
            
            <h3>Q4: è¿™ä¸ªæ–¹æ¡ˆèƒ½å¤„ç†å¤šå°‘æ•°æ®é‡ï¼Ÿ</h3>
            <p>
                <strong>A:</strong> ClickHouseå¤©ç”Ÿä¸ºå¤§æ•°æ®è®¾è®¡ã€‚å•ä¸ªè¡¨å¯è½»æ¾å¤„ç†æ•°åäº¿åˆ°æ•°ç™¾äº¿è¡Œæ•°æ®ã€‚å¦‚æœæ•°æ®é‡è¶…è¿‡å•æœºå®¹é‡ï¼Œå¯ä»¥ä½¿ç”¨ClickHouseçš„åˆ†å¸ƒå¼é›†ç¾¤ã€‚
            </p>
            
            <h3>Q5: è½¯åˆ é™¤ï¼ˆis_delete=1ï¼‰å’ŒçœŸåˆ é™¤æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>
            <p>
                <strong>A:</strong> è½¯åˆ é™¤åªæ˜¯æ’å…¥ä¸€æ¡æ–°ç‰ˆæœ¬çš„è®°å½•ï¼Œæ ‡è®°ä¸ºå·²åˆ é™¤ï¼Œä½†æ•°æ®ä»ç„¶å­˜åœ¨ã€‚çœŸåˆ é™¤ä¼šç‰©ç†åˆ é™¤æ•°æ®ã€‚ClickHouseæ¨èä½¿ç”¨è½¯åˆ é™¤ï¼Œå› ä¸ºå®ƒæ›´é«˜æ•ˆï¼Œä¸”ä¿ç•™äº†å®Œæ•´çš„å†å²è®°å½•ã€‚
            </p>
            
            <h2 id="section9">9. å…³é”®æ¦‚å¿µé€ŸæŸ¥è¡¨</h2>
            
            <table>
                <thead>
                    <tr>
                        <th>æ¦‚å¿µ</th>
                        <th>å®šä¹‰</th>
                        <th>ç¤ºä¾‹</th>
                        <th>ç”¨é€”</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>ReplacingMergeTree</strong></td>
                        <td>ClickHouseè¡¨å¼•æ“ï¼Œæ”¯æŒå¤šç‰ˆæœ¬ç®¡ç†å’Œå»¶è¿Ÿå»é‡</td>
                        <td><code>ENGINE = ReplacingMergeTree(version)</code></td>
                        <td>å®ç°UPSERTå’Œç‰ˆæœ¬æ§åˆ¶</td>
                    </tr>
                    <tr>
                        <td><strong>version</strong></td>
                        <td>æ•°æ®ç‰ˆæœ¬å·ï¼Œç”¨äºåˆ¤æ–­å“ªæ¡è®°å½•æ˜¯æœ€æ–°çš„</td>
                        <td><code>1732701600000</code>ï¼ˆæ—¶é—´æˆ³ï¼‰</td>
                        <td>ReplacingMergeTreeå»é‡çš„åˆ¤å®šä¾æ®</td>
                    </tr>
                    <tr>
                        <td><strong>update_time</strong></td>
                        <td>è®°å½•æ›´æ–°çš„æ—¶é—´ï¼Œç”¨äºas-ofæŸ¥è¯¢</td>
                        <td><code>2025-12-17 10:00:00</code></td>
                        <td>å®šä½"æŸä¸ªæ—¶åˆ»"çš„æ•°æ®å¿«ç…§</td>
                    </tr>
                    <tr>
                        <td><strong>argMax()</strong></td>
                        <td>èšåˆå‡½æ•°ï¼Œè¿”å›æœ€å¤§å€¼å¯¹åº”çš„å­—æ®µå€¼</td>
                        <td><code>argMax(qty, version)</code></td>
                        <td>è·å–å½“å‰æœ€æ–°çŠ¶æ€</td>
                    </tr>
                    <tr>
                        <td><strong>argMaxIf()</strong></td>
                        <td>å¸¦æ¡ä»¶çš„argMaxï¼Œåœ¨æ»¡è¶³æ¡ä»¶çš„è¡Œä¸­é€‰æœ€å¤§å€¼</td>
                        <td><code>argMaxIf(qty, version, update_time <= t0)</code></td>
                        <td>è·å–ç‰¹å®šæ—¶åˆ»çš„å†å²çŠ¶æ€</td>
                    </tr>
                    <tr>
                        <td><strong>As-ofæŸ¥è¯¢</strong></td>
                        <td>æŸ¥è¯¢æŸä¸ªæ—¶åˆ»çš„æ•°æ®å¿«ç…§</td>
                        <td>æŸ¥è¯¢6å°æ—¶å‰çš„é”€é‡</td>
                        <td>æ—¶é—´æ—…è¡Œã€å†å²å¯¹æ¯”</td>
                    </tr>
                    <tr>
                        <td><strong>è½¯åˆ é™¤</strong></td>
                        <td>é€šè¿‡æ’å…¥æ–°ç‰ˆæœ¬ï¼ˆis_delete=1ï¼‰æ¥æ ‡è®°åˆ é™¤</td>
                        <td><code>is_delete=1</code></td>
                        <td>ä¿ç•™å†å²è®°å½•ï¼Œä¾¿äºå®¡è®¡</td>
                    </tr>
                    <tr>
                        <td><strong>Merge</strong></td>
                        <td>åå°è¿›ç¨‹ï¼Œåˆå¹¶åˆ†åŒºå¹¶å»é‡</td>
                        <td>è‡ªåŠ¨å‘ç”Ÿï¼Œå¯ç”¨OPTIMIZEæ‰‹åŠ¨è§¦å‘</td>
                        <td>èŠ‚çœå­˜å‚¨ç©ºé—´</td>
                    </tr>
                </tbody>
            </table>
            
            <h2 id="section7">7. æ€»ç»“</h2>
            
            <p>
                "å…³äºCK"æ–¹æ¡ˆä¹‹æ‰€ä»¥ä¼˜é›…ï¼Œåœ¨äºå®ƒå®Œç¾åœ°ç»“åˆäº†ä¸šåŠ¡éœ€æ±‚å’ŒæŠ€æœ¯ç‰¹æ€§ï¼š
            </p>
            
            <ul class="feature-list">
                <li><strong>æ¶æ„æç®€</strong>ï¼šæ•°æ®é“¾è·¯æ¸…æ™°ï¼Œ<code>API â†’ INSERT â†’ SQL</code>ï¼Œæ— éœ€å¤æ‚çš„ETLå’Œä¸­é—´å±‚ã€‚</li>
                <li><strong>æˆæœ¬ä½å»‰</strong>ï¼šä»…ç”¨ä¸€ä¸ªClickHouseè¡¨å°±å®ç°äº†å¤šç‰ˆæœ¬æ•°æ®ç®¡ç†å’Œå†å²å›æº¯ã€‚</li>
                <li><strong>é«˜åº¦çµæ´»</strong>ï¼šæŸ¥è¯¢çš„æ—¶é—´çª—å£å¯ä»¥ä»»æ„è°ƒæ•´ï¼Œæ»¡è¶³å„ç§å³å¸­åˆ†æéœ€æ±‚ã€‚</li>
                <li><strong>æ€§èƒ½å“è¶Š</strong>ï¼šå……åˆ†åˆ©ç”¨äº†ClickHouseåˆ—å¼å­˜å‚¨å’Œå¼ºå¤§èšåˆå‡½æ•°çš„èƒ½åŠ›ã€‚</li>
            </ul>
            
            <p style="margin-top: 30px; font-size: 1.1em; color: #667eea; font-weight: 600;">
                å¸Œæœ›è¿™ä»½è¯¦å°½çš„è§£è¯»èƒ½å¸®åŠ©æ‚¨å½»åº•æŒæ¡è¿™ä¸ªæ–¹æ¡ˆçš„ç²¾é«“ã€‚å¦‚æœæ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜ï¼Œéšæ—¶å¯ä»¥æå‡ºï¼
            </p>
        </div>
        
            <h2 id="section10">10. æœ€ä½³å®è·µä¸å®ç°æŒ‡å—</h2>
            
            <h3>å®ç°æ­¥éª¤</h3>
            
            <ol style="margin-left: 20px; margin-bottom: 20px;">
                <li>
                    <strong>ç¬¬ä¸€æ­¥ï¼šè®¾è®¡è¡¨ç»“æ„</strong>
                    <p>
                        æ ¹æ®ä¸šåŠ¡éœ€æ±‚è®¾è®¡è¡¨ç»“æ„ã€‚å¿…é¡»åŒ…å«ï¼š
                    </p>
                    <ul style="margin-left: 20px; margin-bottom: 15px;">
                        <li><code>id</code>ï¼šä¸šåŠ¡ä¸»é”®ï¼ˆå¦‚è®¢å•é¡¹IDï¼‰</li>
                        <li><code>version</code>ï¼šç‰ˆæœ¬å·ï¼ˆé€šå¸¸æ˜¯æ¯«ç§’çº§æ—¶é—´æˆ³ï¼‰</li>
                        <li><code>update_time</code>ï¼šæ›´æ–°æ—¶é—´ï¼ˆç”¨äºas-ofæŸ¥è¯¢ï¼‰</li>
                        <li><code>is_delete</code>ï¼šè½¯åˆ é™¤æ ‡è®°</li>
                        <li>å…¶ä»–ä¸šåŠ¡å­—æ®µ</li>
                    </ul>
                </li>
                <li>
                    <strong>ç¬¬äºŒæ­¥ï¼šåˆ›å»ºè¡¨</strong>
                    <p>
                        ä½¿ç”¨<code>ReplacingMergeTree</code>å¼•æ“ï¼ŒæŒ‡å®š<code>version</code>ä½œä¸ºå»é‡å­—æ®µã€‚
                    </p>
                </li>
                <li>
                    <strong>ç¬¬ä¸‰æ­¥ï¼šæ•°æ®æ¥å…¥</strong>
                    <p>
                        ä»ä¸Šæ¸¸ç³»ç»Ÿï¼ˆå¦‚SP-APIï¼‰æ‹‰å–æ•°æ®ï¼Œæ¯æ¡å˜æ›´éƒ½ç”Ÿæˆä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼Œä½¿ç”¨<code>INSERT</code>å†™å…¥ClickHouseã€‚
                    </p>
                </li>
                <li>
                    <strong>ç¬¬å››æ­¥ï¼šç¼–å†™æŸ¥è¯¢</strong>
                    <p>
                        ä½¿ç”¨<code>argMax</code>å’Œ<code>argMaxIf</code>å‡½æ•°è¿›è¡Œå¿«ç…§æŸ¥è¯¢å’Œå†å²å¯¹æ¯”ã€‚
                    </p>
                </li>
                <li>
                    <strong>ç¬¬äº”æ­¥ï¼šç›‘æ§ä¸ä¼˜åŒ–</strong>
                    <p>
                        ç›‘æ§è¡¨å¤§å°ã€æŸ¥è¯¢æ€§èƒ½ï¼Œå®šæœŸæ‰‹åŠ¨è§¦å‘<code>OPTIMIZE</code>è¿›è¡Œmergeå’Œå»é‡ã€‚
                    </p>
                </li>
            </ol>
            
            <h3>æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
            
            <ul class="feature-list">
                <li><strong>åˆ†åŒºç­–ç•¥</strong>ï¼šæŒ‰<code>update_time</code>æŒ‰å¤©åˆ†åŒºï¼Œä¾¿äºæ•°æ®ç®¡ç†å’ŒæŸ¥è¯¢ä¼˜åŒ–ã€‚</li>
                <li><strong>ç´¢å¼•è®¾è®¡</strong>ï¼šåœ¨<code>id</code>å’Œ<code>seller_sku</code>ä¸Šå»ºç«‹ç¨€ç–ç´¢å¼•ã€‚</li>
                <li><strong>æ•°æ®ä¿ç•™</strong>ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚è®¾ç½®TTLï¼Œè‡ªåŠ¨åˆ é™¤è¿‡æœŸæ•°æ®ã€‚</li>
                <li><strong>æŸ¥è¯¢ä¼˜åŒ–</strong>ï¼šåœ¨<code>WHERE</code>å­å¥ä¸­æ·»åŠ <code>update_time</code>èŒƒå›´ï¼Œå‡å°‘æ‰«ææ•°æ®é‡ã€‚</li>
                <li><strong>å®šæœŸMerge</strong>ï¼šåœ¨ä½å³°æœŸæ‰‹åŠ¨æ‰§è¡Œ<code>OPTIMIZE TABLE</code>ï¼ŒåŠ é€Ÿå»é‡å’Œå‹ç¼©ã€‚</li>
            </ul>
            
            <h3>å¸¸è§é™·é˜±</h3>
            
            <div class="note-box">
                <strong>âŒ é™·é˜±1ï¼šå¿˜è®°æŒ‡å®šversionå­—æ®µ</strong><br>
                å¦‚æœåˆ›å»ºè¡¨æ—¶æ²¡æœ‰æŒ‡å®š<code>ReplacingMergeTree(version)</code>ï¼ŒClickHouseä¼šä½¿ç”¨æ’å…¥é¡ºåºä½œä¸ºç‰ˆæœ¬ï¼Œå¯èƒ½å¯¼è‡´ç»“æœä¸å¯é¢„æµ‹ã€‚
            </div>
            
            <div class="note-box">
                <strong>âŒ é™·é˜±2ï¼šversionå­—æ®µä¸é€’å¢</strong><br>
                versionå¿…é¡»ä¸¥æ ¼é€’å¢ã€‚å¦‚æœå‡ºç°versionå›é€€ï¼Œå»é‡é€»è¾‘ä¼šå‡ºé”™ã€‚å»ºè®®ä½¿ç”¨æ¯«ç§’çº§æ—¶é—´æˆ³æˆ–å•è°ƒé€’å¢çš„åºåˆ—å·ã€‚
            </div>
            
            <div class="note-box">
                <strong>âŒ é™·é˜±3ï¼šæŸ¥è¯¢æ—¶å¿˜è®°èšåˆ</strong><br>
                å¦‚æœç›´æ¥æŸ¥è¯¢è¡¨è€Œä¸ä½¿ç”¨<code>argMax</code>ï¼Œä¼šå¾—åˆ°æ‰€æœ‰ç‰ˆæœ¬çš„æ•°æ®ï¼ŒåŒ…æ‹¬å·²è¿‡æœŸçš„ç‰ˆæœ¬ã€‚å¿…é¡»åœ¨<code>GROUP BY</code>ä¸­èšåˆã€‚
            </div>
            
            <div class="note-box">
                <strong>âŒ é™·é˜±4ï¼šä¿ç•™çª—å£è®¾ç½®è¿‡çŸ­</strong><br>
                å¦‚æœæ•°æ®ä¿ç•™çª—å£å°äºæŸ¥è¯¢çª—å£ï¼Œä¼šå¯¼è‡´å†å²æ•°æ®ä¸¢å¤±ã€‚å»ºè®®ä¿ç•™çª—å£è‡³å°‘æ˜¯æŸ¥è¯¢çª—å£çš„2å€ã€‚
            </div>
            
            <h3>ä¸æ‚¨ç†Ÿæ‚‰æŠ€æœ¯çš„é›†æˆæ–¹æ¡ˆ</h3>
            
            <table>
                <thead>
                    <tr>
                        <th>æŠ€æœ¯æ ˆ</th>
                        <th>é›†æˆæ–¹å¼</th>
                        <th>ä»£ç ç¤ºä¾‹</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Java Web</strong></td>
                        <td>ä½¿ç”¨JDBCæˆ–ClickHouseå®˜æ–¹Javaé©±åŠ¨</td>
                        <td><code>ClickHouseDataSource ds = new ClickHouseDataSource("jdbc:clickhouse://localhost:8123/default");</code></td>
                    </tr>
                    <tr>
                        <td><strong>Python Web</strong></td>
                        <td>ä½¿ç”¨clickhouse-driveråº“</td>
                        <td><code>from clickhouse_driver import Client<br>client = Client('localhost')</code></td>
                    </tr>
                    <tr>
                        <td><strong>Spark</strong></td>
                        <td>ä½¿ç”¨clickhouse-sparkè¿æ¥å™¨</td>
                        <td><code>df.write.format("clickhouse").option("host", "localhost").save()</code></td>
                    </tr>
                    <tr>
                        <td><strong>Flink</strong></td>
                        <td>ä½¿ç”¨Flink ClickHouse Sink</td>
                        <td><code>env.addSink(new ClickHouseSink(...))</code></td>
                    </tr>
                </tbody>
            </table>
            
        <div class="footer">
            <p>ğŸ“„ æœ¬æ–‡æ¡£ç”± Manus AI ç”Ÿæˆ | 2025å¹´12æœˆ</p>
            <p>
                ğŸ“– åŸºäºåŸæ–‡ï¼š
                <a href="https://juejin.cn/post/7584358227611615274" target="_blank" style="color: #667eea; text-decoration: underline;">
                    æ˜é‡‘ - å…³ç¾½CKï¼šåˆ©ç”¨ClickHouseå®ç°æ•°æ®å˜æ›´è¿½è¸ª
                </a>
            </p>
            <p>å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åé¦ˆ</p>
        </div>
    </div>
</body>
</html>
